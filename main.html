<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>–ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f3f3f3; color: #333; }
    .container { max-width: 800px; margin: 50px auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); text-align: center; }
    .title { font-size: 24px; font-weight: bold; margin-bottom: 20px; }
    .card { display: flex; align-items: center; justify-content: space-between; background: #f9f9f9; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); }
    .icon { font-size: 30px; margin-right: 20px; }
    .text { flex: 1; text-align: left; font-size: 18px; font-weight: 500; }
    .value { font-size: 18px; font-weight: bold; color: #333; }
  </style>

  <link rel="stylesheet" href="/pac.css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">

  <script>
    function sendTelegramAlert(message) {
    const telegramBotToken = "7639996461:AAE1Grm61BEjUb6uGqdIz1pvmTO5z4n6-Ak"; 
    const chatId = "879978878";         

    const url = `https://api.telegram.org/bot${telegramBotToken}/sendMessage`;

    const payload = {
        chat_id: chatId,
        text: message
    };

    fetch(url, {
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
    })
    .then(response => response.json())
    .then(data => {
        console.log("–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ:", data);
    })
    .catch(error => {
        console.error("–ü–æ–º–∏–ª–∫–∞ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è –≤ Telegram:", error);
    });
  }

    let gasAlertSent = false;

    function updateData() {
    fetch('http://192.168.0.100/temperature')
      .then(response => response.text())
      .then(data => document.getElementById('temperature').innerText = data + " ¬∞C");

    fetch('http://192.168.0.100/humidity')
      .then(response => response.text())
      .then(data => document.getElementById('humidity').innerText = data + " %");

    fetch('http://192.168.0.100/pressure')
      .then(response => response.text())
      .then(data => document.getElementById('pressure').innerText = data + " hPa");

    fetch('http://192.168.0.100/altitude')
      .then(response => response.text())
      .then(data => document.getElementById('altitude').innerText = data + " m");

    fetch('http://192.168.0.100/gasvalue')
      .then(response => response.text())
      .then(data => {
        document.getElementById('gasValue').innerText = data + " ppm";

        const gasLevel = parseFloat(data);
        const stateText = (gasLevel > 400) ? "–ù–µ–±–µ–∑–ø–µ—á–Ω–∏–π —Ä—ñ–≤–µ–Ω—å!" : "–í—Å–µ –≤ –Ω–æ—Ä–º—ñ!";
        document.getElementById('gasState').innerText = stateText;

        // ‚ö†Ô∏è –ï—Å–ª–∏ –≥–∞–∑ –æ–ø–∞—Å–µ–Ω ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º Telegram —Å–æ–æ–±—â–µ–Ω–∏–µ
        if (stateText === "–ù–µ–±–µ–∑–ø–µ—á–Ω–∏–π —Ä—ñ–≤–µ–Ω—å!") {
            sendTelegramAlert(`‚ö†Ô∏è –£–í–ê–ì–ê! –ó–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ –Ω–µ–±–µ–∑–ø–µ—á–Ω–∏–π —Ä—ñ–≤–µ–Ω—å –≥–∞–∑—É: ${gasLevel} ppm`);
        }
      });
    }
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Google –¢–∞–±–ª–∏—Ü—É
    function sendDataToGoogleSheet() {
        var formData = {
            temperature: document.getElementById('temperature').innerText,
            humidity: document.getElementById('humidity').innerText,
            pressure: document.getElementById('pressure').innerText,
            altitude: document.getElementById('altitude').innerText,
            gasValue: document.getElementById('gasValue').innerText,
            gasState: document.getElementById('gasState').innerText
        };
    
        fetch('https://script.google.com/macros/s/AKfycbz5DH-UVC3OJGBq_cwbqnHYcQ8yQrNXM3-5Eae46Lg5RiIN2RJkpU4L8D49dAnMRME5/exec', {
            method: 'POST',
            body: JSON.stringify(formData)
        })
        .then(response => response.text())
        .then(data => {
            console.log("–î–∞–Ω—ñ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ: " + data);
        })
        .catch(error => {
            console.error('–ü–æ–º–∏–ª–∫–∞ –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è:', error);
        });
    }
    
    setInterval(() => {
        updateData();
        // –ü–æ–¥–æ–∂–¥–∏ 500 –º—Å —á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å, –∑–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤—å
        setTimeout(sendDataToGoogleSheet, 500);
    }, 10000); // –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
    
    window.onload = updateData;
    </script>
    

</head>
<body>
  <div class='container'>
    <div class='title'>–î–∞–Ω—ñ –ø—Ä–æ —Å—Ç–∞–Ω –ø–æ–≤—ñ—Ç—Ä—è</div> <br>
    <div class='card'>
      <div class='icon'>üå°</div>
      <div class='text'>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</div>
      <div class='value' id="temperature">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    <div class='card'>
      <div class='icon'>üíß</div>
      <div class='text'>–í–æ–ª–æ–≥—ñ—Å—Ç—å</div>
      <div class='value' id="humidity">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    <div class='card'>
      <div class='icon'>üí®</div>
      <div class='text'>–ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω–∏–π —Ç–∏—Å–∫</div>
      <div class='value' id="pressure">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    <div class='card'>
      <div class='icon'>‚õ∞</div>
      <div class='text'>–í–∏—Å–æ—Ç–∞ –Ω–∞–¥ —Ä—ñ–≤–Ω–µ–º –º–æ—Ä—è</div>
      <div class='value' id="altitude">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    <div class='card'>
      <div class='icon'>üõ¢</div>
      <div class='text'>–†—ñ–≤–µ–Ω—å –≥–∞–∑—É –≤ –ø–æ–≤—ñ—Ç—Ä—ñ</div>
      <div class='value' id="gasValue">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    <div class='card'>
      <div class='icon'>‚ö†Ô∏è</div>
      <div class='text'>–ù–∞—è–≤–Ω—ñ—Å—Ç—å –≥–∞–∑—É</div>
      <div class='value' id="gasState">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div> <br>

    <button class="button" onclick="window.location.href='/index'">–ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∑ –≥—Ä–∞—Ñ—ñ–∫–∞–º–∏</button>
    <button class="button" onclick="window.location.href='/calendar'">–ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∑ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º</button>
  </div>

</body>
</html>